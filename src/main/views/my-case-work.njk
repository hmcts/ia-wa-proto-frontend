{% extends "template.njk" %}

{% from "components/my-tasks.njk" import myTasks %}
{% from "components/filter-by-location.njk" import filterByLocation %}
{% from "govuk/components/details/macro.njk" import govukDetails %}

{% block header %}
  {{ govukHeader({
    homepageUrl: "/",
    containerClasses: "app-width-container",
    serviceName: "Manage cases",
    serviceUrl: "/",
    navigation: [
      {
        href: "/my-case-work",
        text: "Task list",
        active: true
      },
      {
        href: "/task-list",
        text: "Task manager"
      },
      {
        href: "/",
        text: "Case list"
      },
      {
        href: "#",
        text: "Create case"
      },
      {
        href: "/",
        text: "Sign Out",
        attributes: {
          "id": "sign-out-button"
          }
      }  
    ]
  }) }}
{% endblock %}

{% block content %}
  
<div class="govuk-grid-row">
  <div class="govuk-grid-column-one-half">
    <h1 class="govuk-heading-xl">My casework</h1>      
  </div>
</div>
<div class="govuk-grid-row">
  <div class="govuk-grid-column-one-half">
    <h1 class="govuk-heading-l">My tasks</h1>      
  </div>
</div>

{{ myTasks(tasks.myTasks, "myTasks") }}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-one-half">
      <h1 class="govuk-heading-l">My available tasks</h1>
  </div>
</div>

<div class="govuk-grid-row">
  <div id="ex1" class="govuk-grid-column-two-half">
    {{ govukDetails({
      summaryText: "Filter by location",
      html: filterByLocation(tasks.addLocations, tasks.removeLocations),
      classes: "filter-by-location-details"
    }) }}    
  </div>
</div>

{{ myTasks(tasks.myAvailableTasks, "myAvailableTasks") }}

  
{% endblock %}


{% block pageScripts %}
  {% include "includes/sortable-table-scripts.njk" %}
  {% include "includes/filter-by-location-scripts.njk" %}
  {% include "includes/detail-actions-scripts.njk" %}
  <script>
    new MOJFrontend.SortableTable({
      table: $('table')[0]
    });
    new MOJFrontend.SortableTable({
      table: $('table')[1]
    });

    document.getElementById("my-button").onclick = () => {
      const listItems = document.querySelectorAll('#ss_unimp_list li');
      let query = "";
      for (let step = 0; step < listItems.length; step++) {
        query +="item" + step + '=' + listItems[step].innerText;
        if (step < listItems.length - 1) {
          query += "&";  
        }
       
      }
      location.href = "/filter?" + query;
    }

  </script>
{% endblock %}


